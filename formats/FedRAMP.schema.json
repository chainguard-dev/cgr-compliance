{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://fedramp.gov/schema/documentation.json",
  "title": "FedRAMP Machine-Readable Documentation Schema",
  "type": "object",
  "required": ["info", "FRD", "FRR", "KSI"],
  "properties": {
    "info": {
      "type": "object",
      "required": ["title", "description", "version", "last_updated"],
      "properties": {
        "title": { "type": "string" },
        "description": { "type": "string" },
        "version": { "type": "string" },
        "last_updated": { "type": "string", "format": "date" }
      },
      "additionalProperties": false
    },
    "FRD": {
      "type": "object",
      "required": ["info", "data"],
      "properties": {
        "info": { "$ref": "#/$defs/document_info" },
        "data": { "$ref": "#/$defs/data_container_frd" }
      },
      "additionalProperties": false
    },
    "FRR": {
      "type": "object",
      "patternProperties": {
        "^[A-Z]{3}$": {
          "type": "object",
          "required": ["info", "data"],
          "properties": {
            "info": { "$ref": "#/$defs/document_info" },
            "data": { "$ref": "#/$defs/data_container_frr" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "KSI": {
      "type": "object",
      "patternProperties": {
        "^[A-Z]{3}$": {
          "type": "object",
          "required": [
            "id",
            "name",
            "web_name",
            "short_name",
            "theme",
            "indicators"
          ],
          "properties": {
            "id": { "type": "string", "pattern": "^KSI-[A-Z]{3}$" },
            "name": { "type": "string" },
            "web_name": { "type": "string" },
            "short_name": { "type": "string", "pattern": "^[A-Z]{3}$" },
            "theme": { "type": "string" },
            "indicators": {
              "type": "object",
              "patternProperties": {
                "^KSI-[A-Z]{3}-[A-Z0-9]{3}$": {
                  "$ref": "#/$defs/ksi_indicator"
                }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    }
  },
  "$defs": {
    "document_info": {
      "type": "object",
      "required": ["name", "short_name", "web_name", "effective", "front_matter"],
      "properties": {
        "name": { "type": "string" },
        "short_name": { "type": "string", "pattern": "^[A-Z]{3}$" },
        "web_name": { "type": "string" },
        "effective": {
          "type": "object",
          "properties": {
            "rev5": { "$ref": "#/$defs/effective_entry" },
            "20x": { "$ref": "#/$defs/effective_entry" }
          },
          "additionalProperties": false
        },
        "front_matter": { "$ref": "#/$defs/front_matter" },
        "labels": {
          "type": "object",
          "patternProperties": {
            "^[A-Z]{3}$": {
              "type": "object",
              "required": ["name", "description"],
              "properties": {
                "name": { "type": "string" },
                "description": { "type": "string" }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "effective_entry": {
      "type": "object",
      "required": ["is"],
      "properties": {
        "is": { "type": "string", "enum": ["required", "optional", "no"] },
        "signup_url": { "type": "string" },
        "current_status": { "type": "string" },
        "start_date": { "type": "string", "format": "date" },
        "end_date": { "type": "string", "format": "date" },
        "comments": { "type": "array", "items": { "type": "string" } },
        "warnings": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "front_matter": {
      "type": "object",
      "properties": {
        "authority": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["reference", "reference_url", "description"],
            "properties": {
              "reference": { "type": "string" },
              "reference_url": { "type": "string", "format": "uri" },
              "description": { "type": "string" },
              "delegation": { "type": "string" },
              "delegation_url": { "type": "string", "format": "uri" }
            },
            "additionalProperties": false
          }
        },
        "purpose": { "type": "string" },
        "expected_outcomes": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "data_container_frd": {
      "type": "object",
      "properties": {
        "20x": { "$ref": "#/$defs/frd_definitions_map" },
        "rev5": { "$ref": "#/$defs/frd_definitions_map" },
        "both": { "$ref": "#/$defs/frd_definitions_map" }
      },
      "additionalProperties": false
    },
    "frd_definitions_map": {
      "type": "object",
      "patternProperties": {
        "^FRD-[A-Z]{3}$": { "$ref": "#/$defs/frd_definition" }
      },
      "additionalProperties": false
    },
    "frd_definition": {
      "type": "object",
      "required": ["term", "definition"],
      "properties": {
        "fka": { "type": "string" },
        "term": { "type": "string" },
        "alts": { "type": "array", "items": { "type": "string" } },
        "definition": { "type": "string" },
        "note": { "type": "string" },
        "notes": { "type": "array", "items": { "type": "string" } },
        "reference": { "type": "string" },
        "reference_url": { "type": "string", "format": "uri" },
        "referenceurl": { "type": "string", "format": "uri" },
        "updated": { "$ref": "#/$defs/updated_list" }
      },
      "additionalProperties": false
    },
    "data_container_frr": {
      "type": "object",
      "properties": {
        "20x": { "$ref": "#/$defs/frr_requirements_map" },
        "rev5": { "$ref": "#/$defs/frr_requirements_map" },
        "both": { "$ref": "#/$defs/frr_requirements_map" }
      },
      "additionalProperties": false
    },
    "frr_requirements_map": {
      "type": "object",
      "patternProperties": {
        "^[A-Z]{3}$": {
          "type": "object",
          "patternProperties": {
            "^[A-Z]{3}-[A-Z]{3}-[A-Z0-9]{3}$": {
              "$ref": "#/$defs/frr_requirement"
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "frr_requirement": {
      "type": "object",
      "required": ["name", "affects"],
      "oneOf": [
        {
          "properties": { "statement": {}, "primary_key_word": {} },
          "required": ["statement", "primary_key_word"]
        },
        {
          "properties": { "varies_by_level": {} },
          "required": ["varies_by_level"],
          "not": {
            "required": ["primary_key_word"]
          }
        }
      ],
      "properties": {
        "fka": { "type": "string" },
        "fkas": { "type": "array", "items": { "type": "string" } },
        "statement": { "type": "string" },
        "danger": { "type": "string" },
        "terms": { "type": "array", "items": { "type": "string" } },
        "affects": { "type": "array", "items": { "type": "string" } },
        "name": { "type": "string" },
        "primary_key_word": {
          "$ref": "#/$defs/primary_key_word_enum"
        },
        "following_information": {
          "type": "array",
          "items": { "type": "string" }
        },
        "following_information_bullets": {
          "type": "array",
          "items": { "type": "string" }
        },
        "updated": { "$ref": "#/$defs/updated_list" },
        "note": { "type": "string" },
        "notes": { "type": "array", "items": { "type": "string" } },
        "examples": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["id", "key_tests", "examples"],
            "properties": {
              "id": { "type": "string" },
              "key_tests": { "type": "array", "items": { "type": "string" } },
              "examples": { "type": "array", "items": { "type": "string" } }
            },
            "additionalProperties": false
          }
        },
        "varies_by_level": {
          "type": "object",
          "properties": {
            "low": { "$ref": "#/$defs/frr_requirement_level" },
            "moderate": { "$ref": "#/$defs/frr_requirement_level" },
            "high": { "$ref": "#/$defs/frr_requirement_level" }
          },
          "additionalProperties": false
        },
        "pain_timeframes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "pain",
              "max_days_irv_lev",
              "max_days_nirv_lev",
              "max_days_nlev"
            ],
            "properties": {
              "pain": { "type": "integer" },
              "max_days_irv_lev": { "type": "number" },
              "max_days_nirv_lev": { "type": "number" },
              "max_days_nlev": { "type": "number" }
            },
            "additionalProperties": false
          }
        },
        "timeframe_type": { "type": "string" },
        "timeframe_num": { "type": "number" },
        "notification": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["party", "method", "target"],
            "properties": {
              "party": { "type": "string" },
              "method": { "type": "string" },
              "target": { "type": "string" }
            },
            "additionalProperties": false
          }
        },
        "reference": { "type": "string" },
        "reference_url": { "type": "string", "format": "uri" },
        "impact": {
          "type": "object",
          "properties": {
            "low": { "type": "boolean" },
            "moderate": { "type": "boolean" },
            "high": { "type": "boolean" }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "frr_requirement_level": {
      "type": "object",
      "required": ["primary_key_word"],
      "properties": {
        "statement": { "type": "string" },
        "primary_key_word": { "$ref": "#/$defs/primary_key_word_enum" },
        "timeframe_type": { "type": "string" },
        "timeframe_num": { "type": "number" },
        "pain_timeframes": {
          "type": "array",
          "items": {
            "type": "object",
            "required": [
              "pain",
              "max_days_irv_lev",
              "max_days_nirv_lev",
              "max_days_nlev"
            ],
            "properties": {
              "pain": { "type": "integer" },
              "max_days_irv_lev": { "type": "number" },
              "max_days_nirv_lev": { "type": "number" },
              "max_days_nlev": { "type": "number" }
            },
            "additionalProperties": false
          }
        }
      },
      "additionalProperties": false
    },
    "ksi_indicator": {
      "type": "object",
      "required": ["name"],
      "oneOf": [
        {
          "properties": { "statement": {} },
          "required": ["statement"]
        },
        {
          "properties": { "varies_by_level": {} },
          "required": ["varies_by_level"]
        }
      ],
      "properties": {
        "fka": { "type": "string" },
        "name": { "type": "string" },
        "statement": { "type": "string" },
        "controls": { "type": "array", "items": { "type": "string" } },
        "reference": { "type": "string" },
        "reference_url": { "type": "string", "format": "uri" },
        "updated": { "$ref": "#/$defs/updated_list" },
        "varies_by_level": {
          "type": "object",
          "properties": {
            "low": { "$ref": "#/$defs/ksi_indicator_level" },
            "moderate": { "$ref": "#/$defs/ksi_indicator_level" },
            "high": { "$ref": "#/$defs/ksi_indicator_level" }
          },
          "additionalProperties": false
        },
        "terms": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": false
    },
    "ksi_indicator_level": {
      "type": "object",
      "required": ["statement"],
      "properties": {
        "statement": { "type": "string" }
      },
      "additionalProperties": false
    },
    "primary_key_word_enum": {
      "type": "string",
      "description": "Defines the primary keyword for a requirement or indicator, indicating its strength.",
      "enum": ["MUST", "SHOULD", "MAY", "MUST NOT", "SHOULD NOT"]
    },
    "updated_list": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["date", "comment"],
        "properties": {
          "date": { "type": "string", "format": "date" },
          "comment": { "type": "string" }
        },
        "additionalProperties": false
      }
    }
  }
}
